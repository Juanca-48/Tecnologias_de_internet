<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Inter&display=swap" rel="stylesheet" />
    <link href="../css/index_no_iniciado.css" rel="stylesheet" />
    <title>ZonArte</title>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <a href="home_no_iniciado.html" class="logo">
                <img src="../images/Logo_Nombre.png" alt="ZonArte Logo" class="logo-img">
            </a>

            <!-- Barra de búsqueda centrada -->
            <div class="search-center">
                <div class="search-container">
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="Buscar..." id="searchInput">
                    </div>
                    <div class="dropdown-menu" id="dropdownMenu">
                        <div class="dropdown-title">Amigos</div>

                        <div class="suggestion-item">
                            <div class="suggestion-avatar">AC</div>
                            <div class="suggestion-info">
                                <div class="suggestion-name">Anderson Campos</div>
                                <div class="suggestion-role">Diseñador Gráfico</div>
                            </div>
                            <div class="suggestion-action">+</div>
                        </div>

                        <div class="suggestion-item">
                            <div class="suggestion-avatar">MC</div>
                            <div class="suggestion-info">
                                <div class="suggestion-name">María Contreras</div>
                                <div class="suggestion-role">Artista Digital</div>
                            </div>
                            <div class="suggestion-action">+</div>
                        </div>

                        <div class="dropdown-title">Personas</div>

                        <div class="suggestion-item">
                            <div class="suggestion-avatar">JR</div>
                            <div class="suggestion-info">
                                <div class="suggestion-name">Juan Rodriguez</div>
                                <div class="suggestion-role">Ilustrador</div>
                            </div>
                            <div class="suggestion-action">+</div>
                        </div>

                        <div class="suggestion-item">
                            <div class="suggestion-avatar">SP</div>
                            <div class="suggestion-info">
                                <div class="suggestion-name">Sofia Pereira</div>
                                <div class="suggestion-role">Fotógrafa</div>
                            </div>
                            <div class="suggestion-action">+</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navegación -->
            <nav class="nav-menu">
                <a href="home_no_iniciado.html" class="nav-item active">Inicio</a>
                <a href="acerca.html" class="nav-item">Acerca de mi</a>
                <a href="servicios.html" class="nav-item">Servicios</a>
                <!--<a href="social_no_iniciado.html" class="nav-item">Social</a>-->
                <a href="contacto.html" class="nav-item">Contacto</a>
            </nav>

            <div class="profile-btn">
                <a href="perfil.html">
                    <img src="../images/Perfil.png" alt="Perfil" class="profile-img">
                </a>
            </div>

        </header>

        <script>
        fetch("../get_session.php")    
            .then(r => r.json())
            .then(data => {
                if (data.logged) {
                    document.getElementById("portfolioImage1").src = "../images/" + data.digital1;
                    document.getElementById("portfolioImage2").src = "../images/" + data.digital2;
                    document.getElementById("portfolioImage3").src = "../images/" + data.digital3;
                    document.getElementById("portfolioImage4").src = "../images/" + data.digital4;
                    document.getElementById("muralImage").src = "../images/" + data.mural;
                    document.getElementById("comisionImage").src = "../images/" + data.comision;
                } else {
                    // opcional: redirigir a login
                    window.location.href = "login.html";
                }
            });
        </script>
        
        <!-- Main Content -->
        <main class="main-content">

            <!-- Portfolio Grid con botón de guardar -->
            <section class="portfolio-section">
                <div class="portfolio-grid">
                    <div class="portfolio-item">
                        <img src="../images/" + data.digital1 alt="Arte 1" class="portfolio-section" id="portfolioImage1">
                        <button class="edit-image-btn" onclick="changePortfolioImage1()">Cargar</button>
                        <input type="file" id="portfolioInput1" accept="image/*" style="display:none">
                    </div>
                    <div class="portfolio-item">
                        <img src="../images/" + data.digital2 alt="Arte 2" class="portfolio-section" id="portfolioImage2">
                        <button class="edit-image-btn" onclick="changePortfolioImage2()">Cargar</button>
                        <input type="file" id="portfolioInput2" accept="image/*" style="display:none">
                    </div>
                    <div class="portfolio-item">
                        <img src="../images/" + data.digital3 alt="Arte 3" class="portfolio-section" id="portfolioImage3">
                        <button class="edit-image-btn" onclick="changePortfolioImage3()">Cargar</button>
                        <input type="file" id="portfolioInput3" accept="image/*" style="display:none">
                    </div>
                </div>
                <div class="portfolio-grid">
                    <div class="portfolio-item">
                        <img src="../images/" + data.digital4 alt="Arte 4" class="portfolio-section" id="portfolioImage4">
                        <button class="edit-image-btn" onclick="changePortfolioImage4()">Cargar</button>
                        <input type="file" id="portfolioInput4" accept="image/*" style="display:none">
                    </div>
                    <div class="portfolio-item">
                        <img src="../images/" + data.mural alt="Muralismo" class="portfolio-section" id="muralImage">
                        <button class="edit-image-btn" onclick="changeMuralImage()">Cargar</button>
                        <input type="file" id="muralInput" accept="image/*" style="display:none">
                    </div>
                    <div class="portfolio-item">
                        <img src="../images/" + data.comision alt="Comisiones" class="portfolio-section" id="comisionImage">
                        <button class="edit-image-btn" onclick="changeComisionImage()">Cargar</button>
                        <input type="file" id="comisionInput" accept="image/*" style="display:none">
                    </div>
                </div>
            </section>

            <!-- Mi Trabajo -->
            <section id="trabajo" class="info-section">
                <div class="section-title-editable">
                    <h2 class="section-title">MI TRABAJO</h2>
                    <button class="edit-btn" onclick="toggleWorkEdit()">Editar</button>
                </div>
                <p class="section-text" id="workText"> Diseñador Multimedia Senior - Creative Studio (2021 - Presente)
													Desarrollador Frontend - Tech Solutions (2019 - 2021)
    											Diseñador Gráfico - Freelance (2018 - 2019)</p>
                <div class="edit-container" id="workEdit" style="display:none;">
                    <textarea id="workTextarea" class="edit-textarea" placeholder="Describe tu trabajo..."></textarea>
                    <br><br>
                    <button class="edit-btn" onclick="saveWork()">Guardar</button>
                    <button class="edit-btn cancel-btn" onclick="cancelWork()">Cancelar</button>
                </div>
            </section>

            <!-- Mi Proceso -->
            <section id="proceso" class="info-section">
                <div class="section-title-editable">
                    <h2 class="section-title">MI PROCESO</h2>
                    <button class="edit-btn" id="processEditBtn" onclick="toggleProcessEdit()">Editar</button>
                </div>
                <div class="process-grid" id="processGrid">
                    <div class="process-item">
                        <span class="process-text">Conceptualización</span>
                        <span class="edit-icon">✎</span>
                        <button class="delete-process-btn" onclick="deleteProcessItem(event, this)">×</button>
                    </div>
                    <div class="process-item">
                        <span class="process-text">Bocetos</span>
                        <span class="edit-icon">✎</span>
                        <button class="delete-process-btn" onclick="deleteProcessItem(event, this)">×</button>
                    </div>
                    <div class="process-item">
                        <span class="process-text">Desarrollo</span>
                        <span class="edit-icon">✎</span>
                        <button class="delete-process-btn" onclick="deleteProcessItem(event, this)">×</button>
                    </div>
                    <div class="process-item">
                        <span class="process-text">Finalización</span>
                        <span class="edit-icon">✎</span>
                        <button class="delete-process-btn" onclick="deleteProcessItem(event, this)">×</button>
                    </div>
                </div>
                <div class="process-controls" id="processControls" style="display: none;">
                    <button class="edit-btn" onclick="addProcessItem()">+ Agregar Paso</button>
                </div>
            </section>

        </main>

        <!-- Footer -->
       <footer class="footer">
            <div class="footer-text">Terminos y condiciones</div>
            <div class="footer-links">
                <a href="terminos.html" class="footer-link">Términos</a>
            </div>
        </footer>

    </div>

<script>
let isEditMode = true;

const searchInput = document.getElementById('searchInput');
const dropdownMenu = document.getElementById('dropdownMenu');

searchInput.addEventListener('click', () => {
    dropdownMenu.classList.toggle('active');
});

document.addEventListener('click', (e) => {
    if (!e.target.closest('.search-container')) {
        dropdownMenu.classList.remove('active');
    }
});

document.querySelectorAll('.suggestion-item').forEach(item => {
    item.addEventListener('click', function() {
        const name = this.querySelector('.suggestion-name').textContent;
        searchInput.value = name;
        dropdownMenu.classList.remove('active');
    });
});

const gallery = document.getElementById("gallery");
const saveBtn = document.getElementById("saveGalleryBtn");

function createUploadItem() {
    const div = document.createElement("div");
    div.classList.add("portfolio-item");

    const input = document.createElement("input");
    input.type = "file";
    input.accept = "image/*";
    input.classList.add("image-upload");

    input.addEventListener("change", handleImageUpload);

    div.appendChild(input);
    return div;
}

function handleImageUpload(event) {
    const input = event.target;

    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const parent = input.parentElement;

            const oldImg = parent.querySelector("img");
            if (oldImg) oldImg.remove();

            parent.classList.add("has-image");

            const img = document.createElement("img");
            img.src = e.target.result;
            parent.appendChild(img);

            if (isEditMode) {
                const emptySlots = document.querySelectorAll(".portfolio-item:not(.has-image)");
                if (emptySlots.length === 0) {
                    gallery.appendChild(createUploadItem());
                }
            }
        };
        reader.readAsDataURL(input.files[0]);
    }
}

// Mi Trabajo - Edición
function toggleWorkEdit() {
    const section = document.getElementById('trabajo');
    const text = document.getElementById('workText');
    const editContainer = document.getElementById('workEdit');
    const textarea = document.getElementById('workTextarea');
    const editBtn = section.querySelector('.edit-btn');
    
    if (editBtn.textContent === 'Editar') {
        section.classList.add('editing');
        textarea.value = text.textContent.trim();
        text.style.display = 'none';
        editContainer.style.display = 'block';
        editBtn.textContent = 'Cancelar';
    } else {
        cancelWork();
    }
}

function saveWork() {
    const section = document.getElementById('trabajo');
    const text = document.getElementById('workText');
    const editContainer = document.getElementById('workEdit');
    const textarea = document.getElementById('workTextarea');
    const editBtn = section.querySelector('.edit-btn');
    
    text.textContent = textarea.value.trim();
    section.classList.remove('editing');
    text.style.display = 'block';
    editContainer.style.display = 'none';
    editBtn.textContent = 'Editar';
}

function cancelWork() {
    const section = document.getElementById('trabajo');
    const text = document.getElementById('workText');
    const editContainer = document.getElementById('workEdit');
    const editBtn = section.querySelector('.edit-btn');
    
    section.classList.remove('editing');
    text.style.display = 'block';
    editContainer.style.display = 'none';
    editBtn.textContent = 'Editar';
}

// Mi Proceso - Edición
let isProcessEditMode = false;

function toggleProcessEdit() {
    const section = document.getElementById('proceso');
    const editBtn = document.getElementById('processEditBtn');
    const processControls = document.getElementById('processControls');
    const processItems = document.querySelectorAll('.process-item');
    
    isProcessEditMode = !isProcessEditMode;
    
    if (isProcessEditMode) {
        // Activar modo edición
        section.classList.add('editing');
        editBtn.textContent = 'Guardar';
        processControls.style.display = 'flex';
        
        // Hacer los items editables
        processItems.forEach(item => {
            item.classList.add('editable');
            item.onclick = function() { editProcessItem(this); };
        });
    } else {
        // Desactivar modo edición
        section.classList.remove('editing');
        editBtn.textContent = 'Editar';
        processControls.style.display = 'none';
        
        // Remover editabilidad
        processItems.forEach(item => {
            item.classList.remove('editable');
            item.onclick = null;
            
            // Si hay un input activo, guardarlo
            const input = item.querySelector('.process-edit-input');
            if (input) {
                const textSpan = item.querySelector('.process-text');
                const newText = input.value.trim();
                if (newText !== '') {
                    textSpan.textContent = newText;
                }
                textSpan.style.display = 'block';
                input.remove();
                item.classList.remove('editing');
            }
        });
    }
}

function editProcessItem(item) {
    // Solo permitir edición si el modo está activo
    if (!isProcessEditMode) return;
    
    // Evitar edición si ya hay otro elemento en edición
    const alreadyEditing = document.querySelector('.process-item.editing');
    if (alreadyEditing && alreadyEditing !== item) {
        return;
    }
    
    const textSpan = item.querySelector('.process-text');
    
    // Si ya está en modo edición, no hacer nada
    if (item.classList.contains('editing')) {
        return;
    }
    
    const currentText = textSpan.textContent;
    
    // Crear input para edición
    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'process-edit-input';
    input.value = currentText;
    
    // Marcar como en edición
    item.classList.add('editing');
    
    // Reemplazar texto con input
    textSpan.style.display = 'none';
    item.insertBefore(input, textSpan);
    
    // Focus y seleccionar texto
    input.focus();
    input.select();
    
    // Función para guardar
    const saveEdit = () => {
        const newText = input.value.trim();
        if (newText !== '') {
            textSpan.textContent = newText;
        }
        textSpan.style.display = 'block';
        input.remove();
        item.classList.remove('editing');
    };
    
    // Guardar al presionar Enter
    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            saveEdit();
        }
    });
    
    // Guardar al perder el foco
    input.addEventListener('blur', saveEdit);
    
    // Cancelar con Escape
    input.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            textSpan.style.display = 'block';
            input.remove();
            item.classList.remove('editing');
        }
    });
}

function deleteProcessItem(event, button) {
    event.stopPropagation();
    
    // Solo permitir eliminar si el modo está activo
    if (!isProcessEditMode) return;
    
    const item = button.closest('.process-item');
    const processText = item.querySelector('.process-text').textContent;
    
    if (confirm(`¿Eliminar el paso "${processText}"?`)) {
        item.style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => {
            item.remove();
        }, 300);
    }
}

function addProcessItem() {
    const processGrid = document.getElementById('processGrid');
    
    // Crear nuevo item
    const newItem = document.createElement('div');
    newItem.className = 'process-item editable';
    newItem.onclick = function() { editProcessItem(this); };
    
    const textSpan = document.createElement('span');
    textSpan.className = 'process-text';
    textSpan.textContent = 'Nuevo Paso';
    
    const editIcon = document.createElement('span');
    editIcon.className = 'edit-icon';
    editIcon.innerHTML = '✎';
    
    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'delete-process-btn';
    deleteBtn.innerHTML = '×';
    deleteBtn.onclick = function(e) {
        deleteProcessItem(e, this);
    };
    
    newItem.appendChild(textSpan);
    newItem.appendChild(editIcon);
    newItem.appendChild(deleteBtn);
    processGrid.appendChild(newItem);
    
    // Activar edición automáticamente
    setTimeout(() => {
        editProcessItem(newItem);
    }, 100);
}
    
// Cargar portafolioImage1
        function changePortfolioImage1() {
            document.getElementById("portfolioInput1").click();
        }

        document.getElementById("portfolioInput1").addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (!file) return;

            // Previsualizar inmediatamente sin guardar aún
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById("portfolioImage1").src = e.target.result;
            }
            reader.readAsDataURL(file);

            // Enviar la imagen al servidor para guardarla
            const formData = new FormData();
            formData.append("portfolioImage1", file);

            fetch("../cargar_imagen_port_1.php", {  
                method: "POST",
                body: formData  
            })
            .then(res => res.text())
            .then(data => console.log(data))
            .catch(err => console.error(err));
        });
// Cargar portafolioImage2
        function changePortfolioImage2() {
            document.getElementById("portfolioInput2").click();
        }

        document.getElementById("portfolioInput2").addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (!file) return;

            // Previsualizar inmediatamente sin guardar aún
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById("portfolioImage2").src = e.target.result;
            }
            reader.readAsDataURL(file);

            // Enviar la imagen al servidor para guardarla
            const formData = new FormData();
            formData.append("portfolioImage2", file);

            fetch("../cargar_imagen_port_2.php", {  
                method: "POST",
                body: formData  
            })
            .then(res => res.text())
            .then(data => console.log(data))
            .catch(err => console.error(err));
        });
// Cargar portafolioImage3
        function changePortfolioImage3() {
            document.getElementById("portfolioInput3").click();
        }

        document.getElementById("portfolioInput3").addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (!file) return;

            // Previsualizar inmediatamente sin guardar aún
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById("portfolioImage3").src = e.target.result;
            }
            reader.readAsDataURL(file);

            // Enviar la imagen al servidor para guardarla
            const formData = new FormData();
            formData.append("portfolioImage3", file);

            fetch("../cargar_imagen_port_3.php", {  
                method: "POST",
                body: formData  
            })
            .then(res => res.text())
            .then(data => console.log(data))
            .catch(err => console.error(err));
        });
// Cargar portafolioImage4
        function changePortfolioImage4() {
            document.getElementById("portfolioInput4").click();
        }

        document.getElementById("portfolioInput4").addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (!file) return;

            // Previsualizar inmediatamente sin guardar aún
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById("portfolioImage4").src = e.target.result;
            }
            reader.readAsDataURL(file);

            // Enviar la imagen al servidor para guardarla
            const formData = new FormData();
            formData.append("portfolioImage4", file);

            fetch("../cargar_imagen_port_4.php", {  
                method: "POST",
                body: formData  
            })
            .then(res => res.text())
            .then(data => console.log(data))
            .catch(err => console.error(err));
        });
// Cargar portafolioMural
        function changeMuralImage() {
            document.getElementById("muralInput").click();
        }

        document.getElementById("muralInput").addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (!file) return;

            // Previsualizar inmediatamente sin guardar aún
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById("muralImage").src = e.target.result;
            }
            reader.readAsDataURL(file);

            // Enviar la imagen al servidor para guardarla
            const formData = new FormData();
            formData.append("muralImage", file);

            fetch("../cargar_imagen_mural.php", {  
                method: "POST",
                body: formData  
            })
            .then(res => res.text())
            .then(data => console.log(data))
            .catch(err => console.error(err));
        });
// Cargar portafolioComision
        function changeComisionImage() {
            document.getElementById("comisionInput").click();
        }

        document.getElementById("comisionInput").addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (!file) return;

            // Previsualizar inmediatamente sin guardar aún
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById("comisionImage").src = e.target.result;
            }
            reader.readAsDataURL(file);

            // Enviar la imagen al servidor para guardarla
            const formData = new FormData();
            formData.append("comisionImage", file);

            fetch("../cargar_imagen_comision.php", {  
                method: "POST",
                body: formData  
            })
            .then(res => res.text())
            .then(data => console.log(data))
            .catch(err => console.error(err));
        });
</script>

</body>
</html>